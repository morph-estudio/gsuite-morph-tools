<html>
<head>
  <base target="_top">
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Remember to include jQuery :) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <!-- jQuery Modal -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

  <!-- SWAL -->
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Bootstrap CSS
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
  <script src="https://kit.fontawesome.com/a5769575cc.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://cdn.metroui.org.ua/v4.3.2/css/metro-all.min.css">
  <link rel="stylesheet" href="public/stylesheet.html">
  <?!= HtmlService.createHtmlOutputFromFile('public/stylesheet').getContent(); ?>

  <!-- Project CSS -->
  <style>
  ::-webkit-scrollbar {
    width: 7px;
    height: 6px;
  }
  ::-webkit-scrollbar-track {
    border-radius: 10px;
    background: rgba(0,0,0,0.1);
  }
  ::-webkit-scrollbar-thumb{
    border-radius: 10px;
    background: rgba(0,0,0,0.2);
  }
  ::-webkit-scrollbar-thumb:hover{
    background: rgba(0,0,0,0.25);
  }
  ::-webkit-scrollbar-thumb:active{
    background: rgba(0,0,0,0.3);
  }
  </style>

</head>

<body style="background-color:#fff">

<object data="https://mocarabes.com/wp-content/uploads/2021/11/MORPH-TOOLS-LOGO.svg" class="morphlogo"> </object>

<div id="wait" class="no-visible" style="margin-bottom:5px;">
  <div data-role="progress" data-type="line" data-small="true"></div>
</div>

<select id="select-action" data-role="select" data-filter="false">
  <option value="act-delete" selected="selected">Eliminar hojas</option>
  <option value="act-hide">Ocultar hojas</option>
  <option value="act-clear">Limpiar hojas</option>
</select>

<div><button id="delete-button" class="button-68 frozen mb-3 mt-3" style="width:100%;font-weight:bold">Modificar hojas</button></div>

<div class="row mx-auto">
    <div class="my-search-wrapper mb-1"></div>
    <div class="my-rows-wrapper"></div>
</div>

<table id="worksheetsTable" class="table table-border striped mt-4 mx-auto"
       data-role="table"
       data-rows="5"
       data-rows-steps="5, 10"
       data-show-activity="false"
       data-rownum="true"
       data-check="true"
       data-check-style="2"
       data-cls-row-even=".clsRowOdd"
       data-info-wrapper=".my-info-wrapper"
       data-pagination-wrapper=".my-pagination-wrapper"
       data-search-wrapper=".my-search-wrapper"
       data-rows-wrapper=".my-rows-wrapper">
  <thead>
    <tr>
      <th class="col100px" data-sortable="true">Hojas</th>
    </tr>
  </thead>

  <tbody>
    
  </tbody>

</table>

<p class="text-center my-info-wrapper mb-1"></p>
<div class="d-flex flex-justify-center my-pagination-wrapper"></div>

<!-- Project CSS 

<div class="container mt-2 mb-2">

<table class="table">
  <thead>
    <tr>
      <th scope="col">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
        </div>
      </th>
      <th scope="col">Lorem</th>
      <th scope="col">Ipsum</th>
      <th scope="col">Dolor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
        </div>
      </th>
      <td>Sit</td>
      <td>Amet</td>
      <td>Consectetur</td>
    </tr>
    <tr>
      <th scope="row">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
        </div>
      </th>
      <td>Adipisicing</td>
      <td>Elit</td>
      <td>Sint</td>
    </tr>
    <tr>
      <th scope="row">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"/>
        </div>
      </th>
      <td>Hic</td>
      <td>Fugiat</td>
      <td>Temporibus</td>
    </tr>
  </tbody>
</table>

</div>

-->























  <script>
    const WorksheetDeleteApp = {}

    WorksheetDeleteApp.afterSidebarLoads = function (){
      WorksheetDeleteApp.worksheetsTable1 = Metro.getPlugin("#worksheetsTable", "table")
      // WorksheetDeleteApp.worksheetsTable2 = Metro.getPlugin("#select-action", "select")
      WorksheetDeleteApp.wait = document.getElementById("wait")
      WorksheetDeleteApp.loadWorksheetNames()
    } // afterSidebarLoads

    WorksheetDeleteApp.loadWorksheetNames = function(){

      google.script.run.withSuccessHandler(sheetNames => {
        WorksheetDeleteApp.worksheetsTable1.setItems(sheetNames)
        WorksheetDeleteApp.worksheetsTable1.reload()
        WorksheetDeleteApp.wait.classList.add("no-visible")
      }).getWorksheetNames()

    }

    WorksheetDeleteApp.deleteSheets = function(){

      WorksheetDeleteApp.wait.classList.remove("no-visible");

      var sheetNamesToDelete = WorksheetDeleteApp.worksheetsTable1.getSelectedItems().map(r => r[0]);
      var sheetNamesToDeleteAsString = JSON.stringify(sheetNamesToDelete);

      var gmtAction = document.getElementById("select-action");
      var rowData = {
      gmtAction: gmtAction.value,
      };

      google.script.run.withSuccessHandler(e => {swalsuccess(), WorksheetDeleteApp.loadWorksheetNames()}).withFailureHandler(swalerror).deleteWorksheets(sheetNamesToDeleteAsString, rowData)

    }


    WorksheetDeleteApp.openDialogActions = function(){

      var selectedWorksheetCount = WorksheetDeleteApp.worksheetsTable1.getSelectedItems().length
      console.log(selectedWorksheetCount)
      var worksheetCount = WorksheetDeleteApp.worksheetsTable1.getItems().length

            Swal.fire({
            title: 'Borrar hojas',
            text: `Vas a modificar ${selectedWorksheetCount} hojas. Confirma para continuar.`,
            icon: 'info',
            allowOutsideClick: false,
            //preConfirm: Swal.deleteEmptyRows(),
            showLoaderOnConfirm: true,
            showDenyButton: false,
            showCancelButton: true,
            cancelButtonText: `Cancelar`,
            confirmButtonText: `Continuar`,
            confirmButtonColor: '#0D6EFD',
            }).then((result) => {
            if (result.isConfirmed) {

            WorksheetDeleteApp.deleteSheets()


            } else if (result.isDenied) {
              return;
            }
            });

      if(selectedWorksheetCount === worksheetCount){


      }else{

      }

    }

    document.addEventListener("DOMContentLoaded",WorksheetDeleteApp.afterSidebarLoads)
    document.getElementById("delete-button").addEventListener("click", WorksheetDeleteApp.openDialogActions)

  </script>







  <script>
    function swalsuccess(e) {
      Swal.fire({
        title: '¡Listo!',
        text: 'Se han eliminado las hojas seleccionadas.',
        icon: 'success',
        confirmButtonColor: '#0D6EFD',
        confirmButtonText: 'Continuar'
      });
    }
  </script>

  <script>
    function swalsuccess2(e) {
      Swal.fire({
        title: '¡Listo!',
        text: 'El cuadro de superficies se ha actualizado.',
        icon: 'success',
        confirmButtonColor: '#0D6EFD',
        confirmButtonText: 'Continuar'
      });
    }
  </script>

  <script>
    function swalerror(e) {
      Swal.fire({
        title: 'Error!',
        text: 'La función no ha podido ejecutarse.',
        icon: 'error',
        confirmButtonColor: '#0D6EFD',
        confirmButtonText: 'Entendido'
      });
    }
  </script>

  <script>
    function swalinfo(e) {
      Swal.fire({
        title: 'Atención',
        text: 'Esta función aún está en desarrollo...',
        icon: 'info',
        confirmButtonColor: '#0D6EFD',
        confirmButtonText: 'Continuar'
      });
    }
  </script>

  <script>
    function swaload() {
      Swal.fire({
        template: '#swaloadTemplate',
        padding: '1.2em 0em 2em 0em',
        showConfirmButton: false,
        allowOutsideClick: false,
      }).then((result) => {
      if (result.isConfirmed) {
        return true;
      } else if (result.isDenied) {
        return false;
      }
      })
    }
  </script>

<template id="swaloadTemplate">
  <swal-title><div class="swal-tt" ><span class="loading">Ejecutando<span></div></swal-title>
  <swal-html><div class="swal-tt">Por favor, no modifiques ni cierres el documento.</div></swal-html>
  <swal-html><div class="swal2-watermark">MORPH I+D</div></swal-html>

  <swal-image src="https://raw.githubusercontent.com/Codelessly/FlutterLoadingGIFs/master/packages/cupertino_activity_indicator_selective.gif" width="35%" height="auto" />
  <swal-param name="allowEscapeKey" value="false" />
  <swal-param
    name="customClass"
    value='{ "popup": "my-popup" }' />
</template>

<style>
    .loading::after {
      display: inline-block;
      animation: dotty steps(1,end) 2s infinite;
      content: '';
      text-align:left !important;
    }

    @keyframes dotty {
        0%   { content: ''; }
        25%  { content: '.'; }
        50%  { content: '..'; }
        75%  { content: '...'; }
        100% { content: ''; }
    }
</style>



<!-- Bootstrap
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script> -->
<!-- Bootstrap Table
<script src="https://unpkg.com/bootstrap-table@1.20.2/dist/bootstrap-table.min.js"></script>-->

<!-- Metro UI -->
<script src="https://cdn.metroui.org.ua/v4.3.2/js/metro.min.js"></script>

</body>
</html>
