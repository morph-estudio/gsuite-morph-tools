<form novalidate autocomplete="off">

  <div id="userform3">
    <div class="mb-2">

      <label for="list-files" class="form-label"><i class="fa-regular fa-margin fa-folder fa-fw"></i>URL/ID de la carpeta</label>
      <input type="text" class="form-control shadow-none" id="list-files" placeholder="ej: https://drive.google.com/drive/folders/1DHirb56iLf-T_n6Idq2MP8f8Ok765JuZ?usp=sharing" aria-describedby="template-id-2-help" required>
      <div class="invalid-feedback">
      Introduce una URL/ID correcta.
      </div>
      <div id="destination-folder-help" class="form-text">Selecciona la celda donde empezará el listado antes de ejecutar.</div>

      <div class="form-check form-switch mt-3">
        <input class="form-check-input" type="checkbox" onchange="document.getElementById('list-files').disabled = this.checked" role="switch" id="use-a1" >
        <label class="form-check-label" for="use-a1">Usar nota en celda A1 para leer la URL de carpeta</label>
      </div>
      

      <div class="form-check form-switch mt-3">
        <input class="form-check-input" type="checkbox" role="switch" id="list-image-folder" >
        <label class="form-check-label" for="list-image-folder">Insertar imágenes de carpeta</label>
      </div>

      <div class="mt-2 ms-4">
        <div class="form-check form-check-inline">
          <input class="form-check-input arrayelements" type="checkbox" id="imagefolder-public-url">
          <label class="form-check-label" for="imagefolder-public-url">P-URL</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" id="imagefolder-fileid">
          <label class="form-check-label" for="imagefolder-fileid">ID</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input arrayelements" type="checkbox" id="imagefolder-image">
          <label class="form-check-label" for="imagefolder-image">IMG</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" id="imagefolder-arrayformula">
          <label class="form-check-label" for="imagefolder-arrayformula">Usar ArrayFormula</label>
        </div>
      </div>

        <button class="btn btn-primary mainbtn btn-lg-gmt w-100 mt-3" id="listButton">Listar archivos</button>

    </div>
  </div>
</form>

  <div class="mt-2 mb-2">
  <label for="heightNumber" class="form-label mt-3">Altura de filas</label>
  <div class="input-group flex-nowrap update ">
    <span class="input-group-text"><i class="fa-solid fa-arrow-up-1-9"></i></span>
    <input type="text" class="form-control shadow-none" id="heightNumber" placeholder="ej: 100">
    <button class="btn btn-primary shadow-none" type="button" id="increase-rows-height">Go!</button>
  </div>
  <div class="form-text">Introduce la altura <b>en píxeles</b> mientras tienes seleccionado el rango de filas.</div>
  </div>

<script>

$('#list-image-folder').ready(function () {
    if ($(this).prop('checked')) {
        $('#imagefolder-image').attr('checked', true);
        $('#imagefolder-image, #imagefolder-public-url, #imagefolder-fileid,').attr("disabled", false);
    } else {
        $('#imagefolder-image').attr('checked', false);
        $('#imagefolder-image, #imagefolder-public-url, #imagefolder-fileid, #imagefolder-arrayformula').attr("disabled", true);
    }
});

$('#list-image-folder').change(function () {
    if ($(this).prop('checked')) {
        //$('#imagefolder-image').attr('checked', true);
        $('#imagefolder-image, #imagefolder-public-url, #imagefolder-fileid').attr("disabled", false);

  if ($('#imagefolder-public-url').prop('checked') && $('#imagefolder-image').prop('checked', false)) {
    $('#imagefolder-arrayformula').attr("disabled", false);
  } else {
    $('#imagefolder-arrayformula').attr("disabled", true);
  }

    } else {
        //$('#imagefolder-image').attr('checked', false);
        $('#imagefolder-image, #imagefolder-public-url, #imagefolder-fileid, #imagefolder-arrayformula').attr("disabled", true);
    }
});

$('#imagefolder-image').change(function () {
    if ($(this).prop('checked')) {
        $('#imagefolder-arrayformula').attr("disabled", true);
    } else {
        if ($('#imagefolder-public-url').prop('checked')) {
            $('#imagefolder-arrayformula').attr("disabled", false);
        } else {
            $('#imagefolder-arrayformula').attr("disabled", true);
        }
    }
});

$('#imagefolder-public-url').change(function () {
    if ($(this).prop('checked')) {
      if ($('#imagefolder-image').prop('checked')) {
          $('#imagefolder-arrayformula').attr("disabled", true);
      } else {
          $('#imagefolder-arrayformula').attr("disabled", false);
      }
    } else {
        $('#imagefolder-arrayformula').attr("disabled", true);
    }
});


/*
$('.arrayelements').change(function () {

  if ($('#imagefolder-public-url').prop('checked') && $('#imagefolder-image').prop('checked', false)) {
    $('#imagefolder-arrayformula').attr("disabled", false);
  } else {
    $('#imagefolder-arrayformula').attr("disabled", true);
  }

});
*/

</script>

<script>

function afterButtonClicked(){

  if(validate()){

    let listFolderID = document.getElementById("list-files");
    let useA1 = document.getElementById("use-a1").checked;
    let listImageFolder = document.getElementById("list-image-folder").checked;
    let imageFolderPublicURL = document.getElementById("imagefolder-public-url").checked;
    let imageFolderFileID = document.getElementById("imagefolder-fileid").checked;
    let imageFolderImage = document.getElementById("imagefolder-image").checked;
    let imageFolderArrayFormula = document.getElementById("imagefolder-arrayformula").checked;
    let rowData = {
      listFolderID: listFolderID.value,
      useA1,
      imageFolderPublicURL,
      imageFolderFileID,
      imageFolderImage,
      imageFolderArrayFormula
    };
      swaload();
      if (listImageFolder) {
        google.script.run.withSuccessHandler(e => {swalsuccess('Las imágenes se han listado correctamente.'), afterSubmit(e)}).withFailureHandler(swalerror).insertCellImage(rowData);
      } else {
        google.script.run.withSuccessHandler(e => {swalsuccess('Los archivos se han listado correctamente.'), afterSubmit(e)}).withFailureHandler(swalerror).listFilesInFolder(rowData);
      }
  }
}

function blabla(){

    var heightSelectedNumber = document.getElementById("heightNumber").value;
    var rowData = {
      heightSelectedNumber
    }

  execNoSuccess('adjustRowsHeight', rowData);

}

function afterSubmit(e){
  clearFields(["list-files"]);
}

function clearFields(feilds){
  feilds.forEach(function(feild){
    var el = document.getElementById(feild);
    el.value = "";
  });
}

function validate(){
  var fieldsToValidate = document.querySelectorAll("#userform3 input");

  Array.prototype.forEach.call(fieldsToValidate, function(el){
    if (el.checkValidity()){
      el.classList.remove("is-invalid");
    } else{
      el.classList.add("is-invalid");
    }
  });

  return Array.prototype.every.call(fieldsToValidate,function(el){
  return el.checkValidity();
  });
}

document.getElementById("listButton").addEventListener("click",afterButtonClicked);
document.getElementById("increase-rows-height").addEventListener("click",blabla);
  
  </script>